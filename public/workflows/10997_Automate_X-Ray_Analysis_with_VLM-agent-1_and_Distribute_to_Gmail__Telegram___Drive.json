{
  "meta": {
    "name": "Automate X-Ray Analysis with VLM-agent-1 and Distribute to Gmail, Telegram & Drive",
    "id": 10997
  },
  "nodes": [
    {
      "id": "007daf03-5dde-420b-a6ca-b31775b080d3",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        -880
      ],
      "parameters": {
        "width": 560,
        "height": 928,
        "content": "## VLM Run Medical Assistant: Automated X-Ray Analysis  \n\n### Overview  \nThe **VLM Run Medical Assistant** uses VLM Run to automatically analyze X-ray images, detect abnormalities and generate diagnostic insights. It integrates directly into **n8n** workflows using **OpenAI-compatible API endpoints**, ensuring smooth setup and automation.  \n\n### How it works  \n- The workflow starts with a **file upload form**, where medical staff or users can submit **X-ray images**.\n- The uploaded file is passed to **VLM Run (model: `vlm-agent-1`)**, which performs medical image interpretation and highlights potential disease areas.  \n- A **Code node** extracts the resulting image URL from the model’s output.    \n- The workflow then automatically:  \n  - Sends results to the **doctor’s email** for review.  \n  - Sends the same analysis and image to **Telegram** for instant notification.  \n  - Uploads patient data and reports to **Google Drive** for secure storage.  \n\n### Requirements  \n- **VLM Run API credentials** used to call the `vlm-agent-1` model for X-ray analysis and generate disease-marked images.  \n\n- **Gmail OAuth2 credentials** required to automatically email the diagnostic report to medical personnel.  \n\n- **Telegram Bot credentials** used to send analysis results and annotated images directly to a Telegram chat.  \n\n- **Google Drive OAuth2 credentials** needed to upload the patient’s report and annotated X-ray file."
      },
      "typeVersion": 1
    },
    {
      "id": "77254bff-612a-4f72-96dc-afccbdfae02c",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        160,
        -448
      ],
      "parameters": {
        "color": 4,
        "width": 480,
        "height": 496,
        "content": "## Send to Gmail & Telegram  \n\n### How it works  \n- The **Set node** provides two key fields:  \n  - `Description`: The disease diagnosis or “Normal” report from the model output.  \n  - `Output_Image`: The annotated image URL generated by VLM Run.  \n- The **Gmail node** sends a detailed message containing both text and output image to the configured medical email address.  \n- The **Convert to File node** transforms the description into a file format suitable for sharing.  \n- The **Telegram node** sends the annotated X-ray and analysis summary as a document to the target chat or channel.  \n\n\n"
      },
      "typeVersion": 1
    },
    {
      "id": "c8324f03-0089-43c6-b82c-42e3e46e804a",
      "name": "Upload X-Ray Image",
      "type": "n8n-nodes-base.formTrigger",
      "position": [
        -544,
        -112
      ],
      "webhookId": "82848bc4-5ea2-4e5a-8bb6-3c09b94a8c5d",
      "parameters": {
        "options": {},
        "formTitle": "Upload your data to test RAG",
        "formFields": {
          "values": [
            {
              "fieldType": "file",
              "fieldLabel": "data",
              "requiredField": true,
              "acceptFileTypes": ".pdf, .csv"
            }
          ]
        }
      },
      "typeVersion": 2.2,
      "alwaysOutputData": true
    },
    {
      "id": "16abea42-f168-4de5-a4a4-7d71578cf53f",
      "name": "Extract URL",
      "type": "n8n-nodes-base.code",
      "position": [
        0,
        -112
      ],
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const prefix = \"https://storage.googleapis.com\";\n  let foundLink = null;\n\n  // Go through all string fields in the item\n  for (const [key, value] of Object.entries(item.json)) {\n    if (typeof value === \"string\" && value.includes(prefix)) {\n      // Use regex to extract the first matching URL\n      const match = value.match(/https:\\/\\/storage\\.googleapis\\.com\\S+/);\n      if (match) {\n        foundLink = match[0];\n        break;\n      }\n    }\n  }\n\n  item.json.storageLink = foundLink || null;\n}\n\nreturn $input.all();\n"
      },
      "typeVersion": 2
    },
    {
      "id": "e6f8508f-7c65-4ebc-87b8-5ffe52f36fc0",
      "name": "Set Key",
      "type": "n8n-nodes-base.set",
      "position": [
        -16,
        64
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "960e54b4-bf69-4154-9862-2a530709cf3d",
              "name": "Description",
              "type": "string",
              "value": "={{ $json.content }}"
            },
            {
              "id": "71c9e67c-d02a-4cc2-9e72-930b03e83523",
              "name": "Output_Image",
              "type": "string",
              "value": "={{ $json.storageLink }}"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "67c9107f-4bf1-4442-a919-eaf75fc6a024",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        640,
        -336
      ],
      "parameters": {
        "color": 6,
        "width": 400,
        "height": 384,
        "content": "## Upload to Google Drive  \n\n## How it works  \n- The drive node uploads report to a designated Drive folder (e.g., `test_data`).  \n- Each uploaded record can include both the **X-ray report** and the **annotated image**, enabling centralized storage for medical teams.  \n\n"
      },
      "typeVersion": 1
    },
    {
      "id": "a51b21c1-fc75-431e-acdc-f1305c45f966",
      "name": "Convert to Report",
      "type": "n8n-nodes-base.convertToFile",
      "position": [
        688,
        64
      ],
      "parameters": {
        "options": {},
        "operation": "toText",
        "sourceProperty": "="
      },
      "typeVersion": 1.1
    },
    {
      "id": "ea45f7ee-8a0a-433f-b904-dd8bd5b96132",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        16
      ],
      "parameters": {
        "color": 3,
        "width": 320,
        "height": 288,
        "content": "## Download Output Image\n- Used GET request to download output image."
      },
      "typeVersion": 1
    },
    {
      "id": "bc427e01-4928-4d57-a1a2-909a5e9bd9d2",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "position": [
        288,
        128
      ],
      "parameters": {},
      "typeVersion": 3.2
    },
    {
      "id": "64cf13a6-c8c1-4e0f-a004-fc8c9ad0253d",
      "name": "Download Analysis Image",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -288,
        144
      ],
      "parameters": {
        "url": "={{ $json.Output_Image }}",
        "options": {}
      },
      "typeVersion": 4.2
    },
    {
      "id": "5a81de30-fc01-42a5-802b-cef50d3e5890",
      "name": "Analyze X-Ray",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        -240,
        -112
      ],
      "parameters": {
        "text": "You are an expert in X-ray analysis and disease detection. Analyze the given X-ray, mark, fill the affected area and give a disease description only if the patient has a disease, else analyze as a normal X-ray. The output image URL will be give such that URL can be extracted using json.body.response.output_image",
        "modelId": {
          "__rl": true,
          "mode": "id",
          "value": "vlm-agent-1"
        },
        "options": {},
        "resource": "image",
        "inputType": "base64",
        "operation": "analyze"
      },
      "credentials": {
        "openAiApi": {
          "id": "I6lErrUFLJefr5iu",
          "name": "OpenAi account 3"
        }
      },
      "typeVersion": 1.8
    },
    {
      "id": "20c318e1-6706-4916-aee7-813de0104fd9",
      "name": "Send Details",
      "type": "n8n-nodes-base.gmail",
      "position": [
        224,
        -96
      ],
      "webhookId": "9b47f4aa-66d3-4543-bcc2-322e1e341f05",
      "parameters": {
        "sendTo": "mehediahamed@iut-dhaka.edu",
        "message": "Here is the Patient X Ray Analysis report-",
        "options": {
          "attachmentsUi": {
            "attachmentsBinary": [
              {},
              {}
            ]
          }
        },
        "subject": "Patient X Ray Analysis"
      },
      "credentials": {
        "gmailOAuth2": {
          "id": "MWzlgrYVEpT0ytiz",
          "name": "Gmail account 8"
        }
      },
      "typeVersion": 2.1
    },
    {
      "id": "f58e60ed-0d94-4947-87f6-71115876c026",
      "name": "Send Details1",
      "type": "n8n-nodes-base.telegram",
      "position": [
        464,
        -96
      ],
      "webhookId": "e40c3e5a-90cf-4f16-bdd6-f3c50dc2684e",
      "parameters": {
        "chatId": "1872183963",
        "operation": "sendDocument",
        "binaryData": true,
        "additionalFields": {}
      },
      "credentials": {
        "telegramApi": {
          "id": "yr6HR896cjhh3azp",
          "name": "Telegram account"
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "feef517b-7230-4248-9ccf-a6d2da5ba15c",
      "name": "Upload Report",
      "type": "n8n-nodes-base.googleDrive",
      "position": [
        784,
        -96
      ],
      "parameters": {
        "name": "Patient Info",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive",
          "cachedResultName": "My Drive"
        },
        "options": {},
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "1S6baavqJn98MjUlbB6KtmARCWuWEekIZ",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1S6baavqJn98MjUlbB6KtmARCWuWEekIZ",
          "cachedResultName": "test_data"
        }
      },
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "NZLNwCDDYmGxAK2K",
          "name": "Google Drive account 6"
        }
      },
      "typeVersion": 3
    }
  ],
  "pinData": {},
  "connections": {
    "Merge": {
      "main": [
        [
          {
            "node": "Send Details",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Details1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Upload Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Key": {
      "main": [
        [
          {
            "node": "Convert to Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Download Analysis Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract URL": {
      "main": [
        [
          {
            "node": "Set Key",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze X-Ray": {
      "main": [
        [
          {
            "node": "Extract URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to Report": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload X-Ray Image": {
      "main": [
        [
          {
            "node": "Analyze X-Ray",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Analysis Image": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "id": "10997"
}